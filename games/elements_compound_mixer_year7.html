<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elements & Compound Mixer - Year 7 Science Chemistry</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%);
            color: #1d1d1f;
            min-height: 100vh;
            line-height: 1.6;
        }

        .game-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem;
        }

        .game-header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .game-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4338ca;
            margin-bottom: 0.5rem;
        }

        .game-header p {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 1rem;
        }

        .game-modes {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
        }

        .mode-btn {
            background: linear-gradient(135deg, #4338ca, #6366f1);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 56, 202, 0.3);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
        }

        .mixing-lab {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .periodic-table {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.5rem;
            margin-bottom: 2rem;
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem;
        }

        .element-tile {
            background: linear-gradient(135deg, #f8f9ff, #e0e7ff);
            border: 2px solid #c7d2fe;
            border-radius: 8px;
            padding: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .element-tile:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
            border-color: #6366f1;
        }

        .element-tile.selected {
            background: linear-gradient(135deg, #4338ca, #6366f1);
            color: white;
        }

        .element-symbol {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .element-name {
            font-size: 0.7rem;
            margin-top: 0.25rem;
        }

        .mixing-area {
            background: #f8f9fa;
            border: 3px dashed #4338ca;
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            margin: 1.5rem 0;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .selected-elements {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .selected-element {
            background: white;
            border: 2px solid #4338ca;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #4338ca;
        }

        .mix-btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 24px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .mix-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }

        .mix-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result-display {
            background: #f0fdf4;
            border: 2px solid #22c55e;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
            display: none;
        }

        .result-display.show {
            display: block;
        }

        .result-display.error {
            background: #fef2f2;
            border-color: #ef4444;
        }

        .compound-formula {
            font-size: 2rem;
            font-weight: 700;
            color: #16a34a;
            margin-bottom: 0.5rem;
        }

        .compound-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 1rem;
        }

        .compound-info {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            text-align: left;
        }

        .quiz-section {
            display: none;
        }

        .quiz-section.active {
            display: block;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .question {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 1.5rem;
        }

        .choices {
            display: grid;
            gap: 1rem;
            margin: 1rem 0;
        }

        .choice-btn {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1rem;
        }

        .choice-btn:hover {
            border-color: #4338ca;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 56, 202, 0.2);
        }

        .choice-btn.correct {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .choice-btn.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .feedback {
            background: #e7f3ff;
            border-left: 4px solid #0066cc;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .progress-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1rem 0;
        }

        .progress-bar {
            background: #e5e7eb;
            border-radius: 10px;
            height: 8px;
            flex-grow: 1;
            overflow: hidden;
            margin: 0 1rem;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4338ca, #6366f1);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .score-display {
            font-weight: 600;
            color: #4338ca;
            font-size: 1.1rem;
        }

        .clear-btn {
            background: #f3f4f6;
            color: #374151;
            border: 2px solid #d1d5db;
            border-radius: 15px;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 1rem;
        }

        .clear-btn:hover {
            background: #e5e7eb;
        }

        @media (max-width: 768px) {
            .game-header h1 {
                font-size: 2rem;
            }

            .periodic-table {
                grid-template-columns: repeat(4, 1fr);
            }

            .game-modes {
                flex-direction: column;
                align-items: center;
            }

            .selected-elements {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>üß™ Elements & Compound Mixer</h1>
            <p>Explore the periodic table and create chemical compounds through interactive mixing</p>
            <div class="game-modes">
                <button class="mode-btn active" onclick="switchMode('mixer')" id="mixerBtn">Compound Mixer</button>
                <button class="mode-btn" onclick="switchMode('quiz')" id="quizBtn">Chemistry Quiz</button>
            </div>
        </div>

        <div class="mixing-lab" id="mixerMode">
            <h3 style="color: #4338ca; margin-bottom: 1rem;">Select elements from the periodic table to create compounds</h3>

            <div class="periodic-table" id="periodicTable">
                <!-- Elements will be populated here -->
            </div>

            <div class="mixing-area">
                <div class="selected-elements" id="selectedElements">
                    <p style="color: #666;">Click elements above to add them to your mixture</p>
                </div>
                <button class="mix-btn" id="mixBtn" onclick="mixElements()" disabled>Mix Elements</button>
                <button class="clear-btn" onclick="clearSelection()">Clear All</button>
            </div>

            <div class="result-display" id="resultDisplay">
                <!-- Results will be displayed here -->
            </div>
        </div>

        <div class="quiz-section" id="quizMode">
            <div class="progress-container">
                <span>Progress:</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress"></div>
                </div>
                <div class="score-display" id="scoreDisplay">0/6</div>
            </div>
            <div id="quizContent">
                <!-- Quiz questions will be populated here -->
            </div>
        </div>
    </div>

    <script>
        const elements = [
            { symbol: 'H', name: 'Hydrogen', type: 'nonmetal' },
            { symbol: 'He', name: 'Helium', type: 'noble' },
            { symbol: 'Li', name: 'Lithium', type: 'metal' },
            { symbol: 'Be', name: 'Beryllium', type: 'metal' },
            { symbol: 'B', name: 'Boron', type: 'metalloid' },
            { symbol: 'C', name: 'Carbon', type: 'nonmetal' },
            { symbol: 'N', name: 'Nitrogen', type: 'nonmetal' },
            { symbol: 'O', name: 'Oxygen', type: 'nonmetal' },
            { symbol: 'F', name: 'Fluorine', type: 'nonmetal' },
            { symbol: 'Ne', name: 'Neon', type: 'noble' },
            { symbol: 'Na', name: 'Sodium', type: 'metal' },
            { symbol: 'Mg', name: 'Magnesium', type: 'metal' },
            { symbol: 'Al', name: 'Aluminium', type: 'metal' },
            { symbol: 'Si', name: 'Silicon', type: 'metalloid' },
            { symbol: 'P', name: 'Phosphorus', type: 'nonmetal' },
            { symbol: 'S', name: 'Sulphur', type: 'nonmetal' },
            { symbol: 'Cl', name: 'Chlorine', type: 'nonmetal' },
            { symbol: 'Ar', name: 'Argon', type: 'noble' },
            { symbol: 'K', name: 'Potassium', type: 'metal' },
            { symbol: 'Ca', name: 'Calcium', type: 'metal' },
            { symbol: 'Fe', name: 'Iron', type: 'metal' },
            { symbol: 'Cu', name: 'Copper', type: 'metal' },
            { symbol: 'Zn', name: 'Zinc', type: 'metal' },
            { symbol: 'Br', name: 'Bromine', type: 'nonmetal' },
            { symbol: 'I', name: 'Iodine', type: 'nonmetal' },
            { symbol: 'Ba', name: 'Barium', type: 'metal' },
            { symbol: 'Ag', name: 'Silver', type: 'metal' }
        ];

        const compounds = {
            'H2O': {
                name: 'Water',
                elements: ['H', 'H', 'O'],
                info: 'The most important compound for life! Water covers about 71% of Earth\'s surface and makes up about 60% of the human body. It has amazing properties like being able to dissolve many substances.'
            },
            'CO2': {
                name: 'Carbon Dioxide',
                elements: ['C', 'O', 'O'],
                info: 'A greenhouse gas that plants use for photosynthesis! Humans breathe out CO‚ÇÇ, and plants take it in to make food and release oxygen. It\'s also what makes fizzy drinks bubbly.'
            },
            'CO': {
                name: 'Carbon Monoxide',
                elements: ['C', 'O'],
                info: 'A dangerous poisonous gas! Carbon monoxide is colorless and odorless, which makes it very dangerous. It\'s produced when there isn\'t enough oxygen for complete combustion. Always ensure good ventilation when burning fuels!'
            },
            'NaCl': {
                name: 'Sodium Chloride (Salt)',
                elements: ['Na', 'Cl'],
                info: 'Common table salt! This compound is essential for life and has been used to preserve food for thousands of years. Your body needs small amounts of sodium and chloride to function properly.'
            },
            'HCl': {
                name: 'Hydrochloric Acid',
                elements: ['H', 'Cl'],
                info: 'A strong acid found in your stomach! Your stomach produces hydrochloric acid to help digest food and kill harmful bacteria. In laboratories, it\'s used for many chemical reactions and cleaning.'
            },
            'CaCO3': {
                name: 'Calcium Carbonate',
                elements: ['Ca', 'C', 'O', 'O', 'O'],
                info: 'Found in chalk, limestone, and eggshells! This compound is what makes your bones and teeth strong. It\'s also used to make cement and paper.'
            },
            'CH4': {
                name: 'Methane',
                elements: ['C', 'H', 'H', 'H', 'H'],
                info: 'Natural gas that we use for cooking and heating! It\'s also produced by cows and other animals. Methane is a simple hydrocarbon and an important energy source.'
            },
            'NH3': {
                name: 'Ammonia',
                elements: ['N', 'H', 'H', 'H'],
                info: 'Used in cleaning products and fertilisers! Ammonia has a strong smell and is very useful in agriculture to help plants grow by providing nitrogen.'
            },
            'H2SO4': {
                name: 'Sulphuric Acid',
                elements: ['H', 'H', 'S', 'O', 'O', 'O', 'O'],
                info: 'One of the most important industrial chemicals! Sulphuric acid is used in car batteries and to make many other chemicals. It\'s a very strong acid and must be handled with extreme care.'
            },
            'CaO': {
                name: 'Calcium Oxide (Quicklime)',
                elements: ['Ca', 'O'],
                info: 'Also called quicklime! This compound is made by heating limestone and is used in construction to make cement and mortar. When water is added to it, it gets very hot!'
            },
            'MgO': {
                name: 'Magnesium Oxide',
                elements: ['Mg', 'O'],
                info: 'Forms when magnesium burns! Magnesium oxide creates a brilliant white light when magnesium burns in oxygen. It\'s also used in making cement and as an antacid medicine.'
            },
            'FeO': {
                name: 'Iron(II) Oxide',
                elements: ['Fe', 'O'],
                info: 'One type of rust! When iron reacts with oxygen, it can form different oxides. This black powder is used in making glass and ceramics.'
            },
            'KCl': {
                name: 'Potassium Chloride',
                elements: ['K', 'Cl'],
                info: 'Salt substitute and fertiliser! Potassium chloride is used instead of regular salt for people who need less sodium. It\'s also an important fertiliser for plants.'
            },
            'CaCl2': {
                name: 'Calcium Chloride',
                elements: ['Ca', 'Cl', 'Cl'],
                info: 'Road salt for icy conditions! Calcium chloride is used to melt ice on roads because it lowers the freezing point of water. It\'s also used to dry out wet spaces.'
            },
            'NO2': {
                name: 'Nitrogen Dioxide',
                elements: ['N', 'O', 'O'],
                info: 'A brown, toxic gas! Nitrogen dioxide is produced by car engines and power plants. It contributes to air pollution and acid rain, which is why we need cleaner energy sources.'
            },
            'MgSO4': {
                name: 'Magnesium Sulphate (Epsom Salt)',
                elements: ['Mg', 'S', 'O', 'O', 'O', 'O'],
                info: 'Also known as Epsom salt! Magnesium sulphate is used in baths to soothe sore muscles and as a fertiliser in gardens. It helps plants grow by providing magnesium and sulphur nutrients.'
            },
            'CuSO4': {
                name: 'Copper Sulphate',
                elements: ['Cu', 'S', 'O', 'O', 'O', 'O'],
                info: 'Beautiful blue crystals! Copper sulphate is used as a fungicide in gardens, in swimming pools to control algae, and in science experiments. Its bright blue colour makes it easy to identify.'
            },
            'HNO3': {
                name: 'Nitric Acid',
                elements: ['H', 'N', 'O', 'O', 'O'],
                info: 'A strong acid used in making fertilisers and explosives! Nitric acid is very corrosive and reacts with metals to produce hydrogen gas. It\'s essential in the industrial production of many chemicals.'
            },
            'NaOH': {
                name: 'Sodium Hydroxide (Caustic Soda)',
                elements: ['Na', 'O', 'H'],
                info: 'A very strong alkali used in making soap and paper! Sodium hydroxide is extremely caustic and can cause severe burns. It\'s used in drain cleaners and industrial processes.'
            },
            'Ca(OH)2': {
                name: 'Calcium Hydroxide (Slaked Lime)',
                elements: ['Ca', 'O', 'H', 'H'],
                info: 'Made when quicklime reacts with water! Calcium hydroxide is used in making cement, treating water, and in traditional whitewash for buildings.'
            },
            'Fe2O3': {
                name: 'Iron(III) Oxide (Rust)',
                elements: ['Fe', 'Fe', 'O', 'O', 'O'],
                info: 'The familiar red-brown rust! This forms when iron reacts with oxygen and water over time. It\'s also used as a pigment in paints and as an abrasive.'
            },
            'Al2O3': {
                name: 'Aluminium Oxide',
                elements: ['Al', 'Al', 'O', 'O', 'O'],
                info: 'Found in rubies and sapphires! Aluminium oxide is extremely hard and is used as an abrasive and in making aluminium metal through electrolysis.'
            },
            'SiO2': {
                name: 'Silicon Dioxide (Silica)',
                elements: ['Si', 'O', 'O'],
                info: 'The main component of sand and glass! Silicon dioxide forms beautiful crystals like quartz and is essential in making computer chips and glass.'
            },
            'SO2': {
                name: 'Sulphur Dioxide',
                elements: ['S', 'O', 'O'],
                info: 'A gas that causes acid rain! Sulphur dioxide is produced when fossil fuels burn and can cause respiratory problems. It\'s also used as a food preservative.'
            },
            'N2O': {
                name: 'Nitrous Oxide (Laughing Gas)',
                elements: ['N', 'N', 'O'],
                info: 'Used as an anesthetic and in rocket fuel! Nitrous oxide makes people feel giggly when inhaled in small amounts, but it\'s also a greenhouse gas.'
            },
            'P2O5': {
                name: 'Phosphorus Pentoxide',
                elements: ['P', 'P', 'O', 'O', 'O', 'O', 'O'],
                info: 'A powerful drying agent! Phosphorus pentoxide absorbs water so strongly that it can dehydrate other compounds. It\'s used in making phosphoric acid.'
            },
            'ZnO': {
                name: 'Zinc Oxide',
                elements: ['Zn', 'O'],
                info: 'Used in sunscreen and paint! Zinc oxide provides excellent UV protection and is also used in rubber production and as a white pigment.'
            },
            'CuO': {
                name: 'Copper(II) Oxide',
                elements: ['Cu', 'O'],
                info: 'A black powder that forms when copper burns! Copper oxide is used in making other copper compounds and in some ceramic glazes.'
            },
            'BaCl2': {
                name: 'Barium Chloride',
                elements: ['Ba', 'Cl', 'Cl'],
                info: 'Used in fireworks and rat poison! Barium chloride produces green flames in fireworks but is toxic to mammals. It\'s also used in water treatment.'
            },
            'AgNO3': {
                name: 'Silver Nitrate',
                elements: ['Ag', 'N', 'O', 'O', 'O'],
                info: 'Used in photography and medicine! Silver nitrate turns black when exposed to light, making it useful in old-fashioned photography. It\'s also antiseptic.'
            },
            'NaBr': {
                name: 'Sodium Bromide',
                elements: ['Na', 'Br'],
                info: 'Once used as a sedative! Sodium bromide has a calming effect and was historically used in medicine. It\'s now used in oil drilling and photography.'
            },
            'KI': {
                name: 'Potassium Iodide',
                elements: ['K', 'I'],
                info: 'Essential for thyroid health! Potassium iodide is added to salt to prevent iodine deficiency. It\'s also used to protect against radiation exposure.'
            },
            'CaBr2': {
                name: 'Calcium Bromide',
                elements: ['Ca', 'Br', 'Br'],
                info: 'Used in oil drilling and photography! Calcium bromide is very soluble in water and is used as a dense drilling fluid in oil wells.'
            },
            'MgCl2': {
                name: 'Magnesium Chloride',
                elements: ['Mg', 'Cl', 'Cl'],
                info: 'Used for de-icing roads and tofu production! Magnesium chloride is less corrosive than salt for de-icing and is used to coagulate soy milk into tofu.'
            }
        };

        const quizQuestions = [
            {
                question: "What is the chemical formula for water?",
                choices: ["H2O", "CO2", "NaCl", "O2"],
                correct: 0,
                feedback: "Correct! Water is H‚ÇÇO - two hydrogen atoms bonded to one oxygen atom. This is the most important compound for all life on Earth!"
            },
            {
                question: "Which gas do plants absorb from the air during photosynthesis?",
                choices: ["Oxygen", "Carbon Dioxide", "Nitrogen", "Hydrogen"],
                correct: 1,
                feedback: "Excellent! Plants absorb carbon dioxide (CO‚ÇÇ) from the air and use it with water and sunlight to make glucose and release oxygen."
            },
            {
                question: "What type of bond forms when a metal gives electrons to a non-metal?",
                choices: ["Covalent bond", "Ionic bond", "Metallic bond", "Hydrogen bond"],
                correct: 1,
                feedback: "Perfect! An ionic bond forms when metals lose electrons to non-metals, creating charged ions that attract each other, like in salt (NaCl)."
            },
            {
                question: "Which element is essential for all organic compounds?",
                choices: ["Oxygen", "Hydrogen", "Carbon", "Nitrogen"],
                correct: 2,
                feedback: "Spot on! Carbon is the backbone of all organic compounds. It can form four bonds and create chains, rings, and complex structures."
            },
            {
                question: "What happens to atoms when they form chemical bonds?",
                choices: ["They disappear", "They share or transfer electrons", "They change into different elements", "They become radioactive"],
                correct: 1,
                feedback: "Excellent! When atoms form chemical bonds, they share electrons (covalent) or transfer electrons (ionic) to become more stable."
            },
            {
                question: "Which compound is commonly known as table salt?",
                choices: ["CaCO3", "NaCl", "H2SO4", "KBr"],
                correct: 1,
                feedback: "Correct! NaCl (sodium chloride) is table salt. It's an ionic compound formed from sodium metal and chlorine gas."
            }
        ];

        let selectedElements = [];
        let currentQuestion = 0;
        let quizScore = 0;

        function initializeGame() {
            createPeriodicTable();
        }

        function createPeriodicTable() {
            const periodicTable = document.getElementById('periodicTable');
            periodicTable.innerHTML = '';

            elements.forEach(element => {
                const tile = document.createElement('div');
                tile.className = 'element-tile';
                tile.onclick = () => selectElement(element.symbol);
                tile.innerHTML = `
                    <div class="element-symbol">${element.symbol}</div>
                    <div class="element-name">${element.name}</div>
                `;
                periodicTable.appendChild(tile);
            });
        }

        function selectElement(symbol) {
            // Clear previous results when starting a new selection
            if (selectedElements.length === 0) {
                document.getElementById('resultDisplay').classList.remove('show', 'error');
            }

            if (selectedElements.length < 8) { // Allow more complex compounds
                selectedElements.push(symbol);
                updateSelectedDisplay();
                updateMixButton();
            }
        }

        function updateSelectedDisplay() {
            const container = document.getElementById('selectedElements');

            if (selectedElements.length === 0) {
                container.innerHTML = '<p style="color: #666;">Click elements above to add them to your mixture</p>';
            } else {
                container.innerHTML = selectedElements.map(symbol =>
                    `<div class="selected-element">${symbol}</div>`
                ).join('');
            }
        }

        function updateMixButton() {
            const mixBtn = document.getElementById('mixBtn');
            mixBtn.disabled = selectedElements.length < 2;
            mixBtn.textContent = selectedElements.length < 2 ? 'Select 2+ Elements' : 'Mix Elements';
        }

        function clearSelection() {
            selectedElements = [];
            updateSelectedDisplay();
            updateMixButton();
            document.getElementById('resultDisplay').classList.remove('show', 'error');
        }

        function mixElements() {
            const resultDisplay = document.getElementById('resultDisplay');
            const sortedElements = [...selectedElements].sort();
            const formula = getFormulaFromElements(sortedElements);

            if (compounds[formula]) {
                const compound = compounds[formula];
                const formattedFormula = formatChemicalFormula(formula);
                resultDisplay.className = 'result-display show';
                resultDisplay.innerHTML = `
                    <div class="compound-formula">${formattedFormula}</div>
                    <div class="compound-name">${compound.name}</div>
                    <div class="compound-info">
                        <h4>Fascinating Facts:</h4>
                        <p>${compound.info}</p>
                    </div>
                `;
            } else {
                resultDisplay.className = 'result-display show error';
                resultDisplay.innerHTML = `
                    <div class="compound-formula" style="color: #dc2626;">‚ùå No Compound Formed</div>
                    <div class="compound-name">Elements: ${selectedElements.join(' + ')}</div>
                    <div class="compound-info">
                        <h4>Experiment Result:</h4>
                        <p>These elements don't form a stable compound under normal conditions, or the compound isn't covered in our Year 7 curriculum. Try different combinations like H+H+O for water, or Na+Cl for salt!</p>
                    </div>
                `;
            }

            // Result stays until user starts selecting elements again
        }

        function formatChemicalFormula(formula) {
            // Convert numbers to subscripts in chemical formulas
            return formula.replace(/(\d+)/g, '<sub>$1</sub>');
        }

        function getFormulaFromElements(elements) {
            const elementCounts = {};
            elements.forEach(el => {
                elementCounts[el] = (elementCounts[el] || 0) + 1;
            });

            // Check known patterns
            const patterns = Object.keys(compounds);
            for (let pattern of patterns) {
                if (matchesPattern(elementCounts, pattern)) {
                    return pattern;
                }
            }
            return null;
        }

        function matchesPattern(elementCounts, pattern) {
            const patternCounts = {};
            const compound = compounds[pattern];

            compound.elements.forEach(el => {
                patternCounts[el] = (patternCounts[el] || 0) + 1;
            });

            const elementKeys = Object.keys(elementCounts);
            const patternKeys = Object.keys(patternCounts);

            if (elementKeys.length !== patternKeys.length) return false;

            for (let key of elementKeys) {
                if (elementCounts[key] !== patternCounts[key]) return false;
            }

            return true;
        }

        function switchMode(mode) {
            const mixerBtn = document.getElementById('mixerBtn');
            const quizBtn = document.getElementById('quizBtn');
            const mixerMode = document.getElementById('mixerMode');
            const quizMode = document.getElementById('quizMode');

            if (mode === 'mixer') {
                mixerBtn.classList.add('active');
                quizBtn.classList.remove('active');
                mixerMode.style.display = 'block';
                quizMode.classList.remove('active');
            } else {
                quizBtn.classList.add('active');
                mixerBtn.classList.remove('active');
                mixerMode.style.display = 'none';
                quizMode.classList.add('active');
                if (currentQuestion === 0) {
                    displayQuestion();
                }
            }
        }

        function displayQuestion() {
            if (currentQuestion >= quizQuestions.length) {
                showQuizResults();
                return;
            }

            const question = quizQuestions[currentQuestion];
            const quizContent = document.getElementById('quizContent');

            quizContent.innerHTML = `
                <div class="question-card">
                    <div class="question">${question.question}</div>
                    <div class="choices" id="choices"></div>
                    <div class="feedback" id="feedback"></div>
                </div>
            `;

            const choicesDiv = document.getElementById('choices');
            question.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = choice;
                button.onclick = () => selectAnswer(index);
                choicesDiv.appendChild(button);
            });

            updateQuizProgress();
        }

        function selectAnswer(selectedIndex) {
            const question = quizQuestions[currentQuestion];
            const choices = document.querySelectorAll('.choice-btn');
            const feedback = document.getElementById('feedback');

            choices.forEach((choice, index) => {
                choice.onclick = null;
                if (index === question.correct) {
                    choice.classList.add('correct');
                } else if (index === selectedIndex && index !== question.correct) {
                    choice.classList.add('incorrect');
                }
            });

            if (selectedIndex === question.correct) {
                quizScore++;
                feedback.innerHTML = `<strong>‚úÖ Correct!</strong> ${question.feedback}`;
            } else {
                feedback.innerHTML = `<strong>‚ùå Try again next time!</strong> ${question.feedback}`;
            }

            feedback.classList.add('show');
            updateQuizScore();

            setTimeout(() => {
                currentQuestion++;
                displayQuestion();
            }, 3000);
        }

        function updateQuizProgress() {
            const progress = (currentQuestion / quizQuestions.length) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function updateQuizScore() {
            document.getElementById('scoreDisplay').textContent = `${quizScore}/${quizQuestions.length}`;
        }

        function showQuizResults() {
            const quizContent = document.getElementById('quizContent');
            const percentage = Math.round((quizScore / quizQuestions.length) * 100);

            let feedback = "";
            if (percentage >= 90) {
                feedback = "Outstanding! You're a chemistry star! You clearly understand elements, compounds, and chemical bonding.";
            } else if (percentage >= 70) {
                feedback = "Excellent work! You have a solid understanding of basic chemistry concepts.";
            } else if (percentage >= 50) {
                feedback = "Good job! Keep studying the periodic table and how elements combine to form compounds.";
            } else {
                feedback = "Keep experimenting! Chemistry takes practice. Try the compound mixer to see how elements work together.";
            }

            quizContent.innerHTML = `
                <div class="question-card" style="text-align: center;">
                    <h2>üéâ Chemistry Challenge Complete!</h2>
                    <div class="compound-formula">${quizScore}/${quizQuestions.length}</div>
                    <div class="compound-name">${percentage}% Correct</div>
                    <div class="compound-info">
                        <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">${feedback}</p>
                        <button class="mode-btn" onclick="restartQuiz()">Try Again</button>
                        <button class="mode-btn" onclick="switchMode('mixer')" style="margin-left: 1rem;">Explore Mixer</button>
                    </div>
                </div>
            `;
        }

        function restartQuiz() {
            currentQuestion = 0;
            quizScore = 0;
            updateQuizScore();
            displayQuestion();
        }

        // Initialize the game
        initializeGame();
    </script>
</body>
</html>